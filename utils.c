//
// Created by loona on 10/25/21.
//

#include <unistd.h>
#include <stdio.h>
#include <sys/poll.h>
#include "utils.h"

void sendStr(int fd, char* buffer, size_t countChar) {
    write(fd, buffer, countChar);
    write(fd, "\n", 1);
}

unsigned long waitAndReadAdress(int fd) {
    unsigned long resultAddress = 0;
    char *arrayBytesOfAddress = (char*) &resultAddress;
    char byte;
    for (int i = 0; i < 8 && byte != 0x7f; ++i) {
        read(fd,&byte, 1);
        arrayBytesOfAddress[i] = byte;
    }

    return resultAddress;
}

int readByte(int fd, char* in) {
    struct pollfd pipeFd = {fd, POLLIN, 0};
    poll(&pipeFd, 1, 100);

    if (pipeFd.revents & POLLIN) {
        read(fd, in, 1);
        return 0;
    }
    return -1;
}

void readAllAndPrintLine(int fd) {
    char letter = 0;
    while (!readByte(fd, &letter)) {
        putchar(letter);
    }
}


void waitAndReadCountChar(int fd, int count) {
    char letter = 0;
    while (letter != '\n' && --count > 0) {
        read(fd, &letter, 1);
        putchar(letter);
    }
}