//
// Created by loona on 10/25/21.
//

#include <unistd.h>
#include <stdio.h>
#include <sys/poll.h>
#include "utils.h"

void sendStr(int fd, char* buffer, size_t countChar) {
    write(fd, buffer, countChar);
    write(fd, "\n", 1);
}

unsigned long readAdress(int fd) {
    unsigned long resultAddress = 0;
    char *arrayBytesOfAddress = (char*) &resultAddress;

    for (int i = 0; i < 8; ++i) {
        char byte = readByte(fd);
        if (byte == '\n') {
            return resultAddress;
        }
        arrayBytesOfAddress[i] = byte;
    }

    return -1;
}

char readByte(int fd) {
    char byte = 0;
    struct pollfd pipeFd = {fd, POLLIN, 0};
    poll(&pipeFd, 1, 100);

    if (pipeFd.revents & POLLIN) {
        read(fd, &byte, 1);
        return byte;
    }
    return -1;
}

void readAllAndPrintLine(int fd) {
    char letter = 0;
    while ((letter = readByte(fd)) > -1) {
        putchar(letter);
    }
}
